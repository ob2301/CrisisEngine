import React from 'react';
import './VulnerabilityReport.css';

const VulnerabilityReport = ({ vulnerability }) => {
  if (!vulnerability) return null;

  const getVulnerabilityLevel = (score) => {
    if (score >= 70) return { level: 'Critical', color: '#F44336', icon: 'üî¥' };
    if (score >= 50) return { level: 'High', color: '#FF9800', icon: 'üü†' };
    if (score >= 30) return { level: 'Medium', color: '#FFC107', icon: 'üü°' };
    return { level: 'Low', color: '#4CAF50', icon: 'üü¢' };
  };

  const vulnInfo = getVulnerabilityLevel(vulnerability.score);

  const getFactorIcon = (type) => {
    if (type.includes('police')) return 'üöî';
    if (type.includes('fire')) return 'üöí';
    if (type.includes('flood')) return 'üåä';
    if (type.includes('coverage')) return '‚ö†Ô∏è';
    return 'üìä';
  };

  const getImpactColor = (impact) => {
    switch (impact) {
      case 'Critical': return '#F44336';
      case 'High': return '#FF9800';
      case 'Medium': return '#FFC107';
      default: return '#4CAF50';
    }
  };

  return (
    <div className="card vulnerability-report">
      <h2>üìà Vulnerability Analysis</h2>
      
      <div className="vulnerability-score">
        <div className="score-display">
          <div className="score-circle-wrapper">
            <div className="score-circle" style={{ borderColor: vulnInfo.color }}>
              <span className="score-number">{vulnerability.score}</span>
              <span className="score-label">/ 100</span>
            </div>
            <div className="score-gauge">
              <div 
                className="score-gauge-fill" 
                style={{ 
                  width: `${vulnerability.score}%`,
                  backgroundColor: vulnInfo.color
                }}
              />
            </div>
          </div>
          <div className="score-info">
            <div className="score-level" style={{ color: vulnInfo.color }}>
              {vulnInfo.icon} {vulnInfo.level} Risk
            </div>
            <div className="score-description">
              {vulnInfo.level === 'Critical' && 'Immediate action required. Area is highly vulnerable.'}
              {vulnInfo.level === 'High' && 'Significant risk detected. Enhanced monitoring recommended.'}
              {vulnInfo.level === 'Medium' && 'Moderate risk level. Standard protocols should be sufficient.'}
              {vulnInfo.level === 'Low' && 'Low risk level. Area is well-prepared for this scenario.'}
            </div>
          </div>
        </div>
      </div>

      {vulnerability.factors && vulnerability.factors.length > 0 && (
        <div className="vulnerability-factors">
          <h3>üîç Risk Factors</h3>
          <div className="factors-list">
            {vulnerability.factors.map((factor, idx) => (
              <div key={idx} className="factor-item">
                <div className="factor-icon">{getFactorIcon(factor.type)}</div>
                <div className="factor-content">
                  <div className="factor-header">
                    <span className="factor-type">
                      {factor.type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                    </span>
                    <span 
                      className="factor-impact"
                      style={{ backgroundColor: getImpactColor(factor.impact) + '20', color: getImpactColor(factor.impact) }}
                    >
                      {factor.impact}
                    </span>
                  </div>
                  {factor.value !== undefined && (
                    <div className="factor-value">
                      {typeof factor.value === 'number' && factor.value > 1 
                        ? `Response Time: ${factor.value} minutes`
                        : `Risk Level: ${(factor.value * 100).toFixed(0)}%`
                      }
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      <div className="vulnerability-recommendations">
        <h3>üí° Recommendations</h3>
        <ul className="recommendations-list">
          {vulnerability.score >= 70 && (
            <>
              <li>Deploy additional emergency resources to the affected area immediately</li>
              <li>Establish temporary command center near the disaster zone</li>
              <li>Coordinate with neighboring jurisdictions for mutual aid</li>
              <li>Implement evacuation protocols if necessary</li>
            </>
          )}
          {vulnerability.score >= 50 && vulnerability.score < 70 && (
            <>
              <li>Increase patrol presence in the affected area</li>
              <li>Pre-position emergency equipment for faster response</li>
              <li>Monitor weather and traffic conditions closely</li>
              <li>Ensure communication systems are fully operational</li>
            </>
          )}
          {vulnerability.score >= 30 && vulnerability.score < 50 && (
            <>
              <li>Maintain standard emergency response protocols</li>
              <li>Review resource allocation for optimal coverage</li>
              <li>Conduct regular readiness drills</li>
            </>
          )}
          {vulnerability.score < 30 && (
            <>
              <li>Current resource allocation appears adequate</li>
              <li>Continue monitoring the situation</li>
              <li>Maintain standard operational procedures</li>
            </>
          )}
        </ul>
      </div>

      <div className="data-integration-note">
        <h4>üîó Real-Time Data Integration</h4>
        <p>
          This simulator is designed to integrate with real-time data sources including:
        </p>
        <ul>
          <li><strong>Traffic Data:</strong> Adjust response times based on current road conditions</li>
          <li><strong>Weather Data:</strong> Factor in real-time weather conditions affecting response</li>
          <li><strong>Police Location:</strong> Use GPS tracking of active units for accurate positioning</li>
          <li><strong>Emergency Calls:</strong> Incorporate active emergency calls to assess resource availability</li>
          <li><strong>Infrastructure Status:</strong> Account for road closures, bridge conditions, etc.</li>
        </ul>
        <p className="note-text">
          <strong>Note:</strong> With real-time data integration, this system can provide live vulnerability 
          detection and help identify areas at risk before disasters occur, enabling proactive response planning.
        </p>
      </div>
    </div>
  );
};

export default VulnerabilityReport;

